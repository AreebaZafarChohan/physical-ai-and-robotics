"use strict";(self.webpackChunkphysical_ai_and_robotics=self.webpackChunkphysical_ai_and_robotics||[]).push([[6756],{7126:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>l,contentTitle:()=>a,default:()=>p,frontMatter:()=>o,metadata:()=>i,toc:()=>c});const i=JSON.parse('{"id":"module-ros/rclpy-integration","title":"RCLPY Integration: Python Client Library for ROS 2","description":"When developing robotic applications with ROS 2, Python is a popular choice due to its readability, vast ecosystem of libraries for AI and data science, and rapid prototyping capabilities. RCLPY is the official Python client library for ROS 2, providing a clean and intuitive interface to interact with the core ROS 2 concepts like nodes, topics, services, and actions. This chapter will delve into how to effectively use RCLPY to build robust ROS 2 applications in Python.","source":"@site/docs/01-module-ros/03-rclpy-integration.md","sourceDirName":"01-module-ros","slug":"/module-ros/rclpy-integration","permalink":"/ur/docs/module-ros/rclpy-integration","draft":false,"unlisted":false,"editUrl":"https://github.com/AreebaZafarChohan/physical-ai-and-robotics/tree/main/frontend/docs/01-module-ros/03-rclpy-integration.md","tags":[],"version":"current","sidebarPosition":3,"frontMatter":{"title":"RCLPY Integration: Python Client Library for ROS 2"},"sidebar":"tutorialSidebar","previous":{"title":"Nodes, Topics, and Services in ROS 2","permalink":"/ur/docs/module-ros/nodes-topics-services"},"next":{"title":"URDF for Humanoids in ROS 2","permalink":"/ur/docs/module-ros/urdf-for-humanoids"}}');var s=r(4848),t=r(8453);const o={title:"RCLPY Integration: Python Client Library for ROS 2"},a="RCLPY Integration: Python Client Library for ROS 2",l={},c=[{value:"What is RCLPY?",id:"what-is-rclpy",level:2},{value:"Getting Started: Creating a ROS 2 Python Package",id:"getting-started-creating-a-ros-2-python-package",level:2},{value:"Implementing ROS 2 Nodes with RCLPY",id:"implementing-ros-2-nodes-with-rclpy",level:2},{value:"1. Basic Node Structure",id:"1-basic-node-structure",level:3},{value:"2. Creating a Publisher",id:"2-creating-a-publisher",level:3},{value:"3. Creating a Subscriber",id:"3-creating-a-subscriber",level:3},{value:"4. Implementing a Service Server",id:"4-implementing-a-service-server",level:3},{value:"5. Implementing a Service Client",id:"5-implementing-a-service-client",level:3},{value:"Best Practices for Structuring Python ROS 2 Applications",id:"best-practices-for-structuring-python-ros-2-applications",level:2}];function d(e){const n={code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"rclpy-integration-python-client-library-for-ros-2",children:"RCLPY Integration: Python Client Library for ROS 2"})}),"\n",(0,s.jsxs)(n.p,{children:["When developing robotic applications with ROS 2, Python is a popular choice due to its readability, vast ecosystem of libraries for AI and data science, and rapid prototyping capabilities. ",(0,s.jsx)(n.strong,{children:"RCLPY"})," is the official Python client library for ROS 2, providing a clean and intuitive interface to interact with the core ROS 2 concepts like nodes, topics, services, and actions. This chapter will delve into how to effectively use RCLPY to build robust ROS 2 applications in Python."]}),"\n",(0,s.jsx)(n.h2,{id:"what-is-rclpy",children:"What is RCLPY?"}),"\n",(0,s.jsxs)(n.p,{children:["RCLPY is a Python binding for ",(0,s.jsx)(n.code,{children:"rcl"})," (ROS Client Library), which is a C API that provides the implementation of the core ROS 2 concepts. By building upon ",(0,s.jsx)(n.code,{children:"rcl"}),", RCLPY inherits the performance and efficiency of the underlying C implementation while offering the ease of use and expressiveness of Python. It allows Python developers to seamlessly create ROS 2 nodes and integrate them into a larger ROS 2 graph."]}),"\n",(0,s.jsx)(n.h2,{id:"getting-started-creating-a-ros-2-python-package",children:"Getting Started: Creating a ROS 2 Python Package"}),"\n",(0,s.jsxs)(n.p,{children:["Before writing any Python code, it's good practice to create a dedicated ROS 2 package using ",(0,s.jsx)(n.code,{children:"ament_python"}),"."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"# Assuming you are in your ROS 2 workspace's src directory (e.g., ~/ros2_ws/src)\r\nros2 pkg create --build-type ament_python my_python_pkg\n"})}),"\n",(0,s.jsxs)(n.p,{children:["This command creates a new directory ",(0,s.jsx)(n.code,{children:"my_python_pkg"})," with the necessary ",(0,s.jsx)(n.code,{children:"package.xml"})," and ",(0,s.jsx)(n.code,{children:"setup.py"})," files. Your Python scripts will typically reside in a subdirectory named after your package (e.g., ",(0,s.jsx)(n.code,{children:"my_python_pkg/my_python_pkg/"}),")."]}),"\n",(0,s.jsx)(n.h2,{id:"implementing-ros-2-nodes-with-rclpy",children:"Implementing ROS 2 Nodes with RCLPY"}),"\n",(0,s.jsxs)(n.p,{children:["All ROS 2 applications in RCLPY start with a ",(0,s.jsx)(n.code,{children:"Node"}),"."]}),"\n",(0,s.jsx)(n.h3,{id:"1-basic-node-structure",children:"1. Basic Node Structure"}),"\n",(0,s.jsx)(n.p,{children:"A minimal ROS 2 node in Python looks like this:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"import rclpy\r\nfrom rclpy.node import Node\r\n\r\nclass MinimalNode(Node):\r\n    def __init__(self):\r\n        super().__init__('minimal_node') # Initialize the node with a name\r\n        self.get_logger().info(\"Minimal Node has been started!\")\r\n\r\ndef main(args=None):\r\n    rclpy.init(args=args)           # Initialize ROS 2 communication\r\n    node = MinimalNode()            # Create an instance of your node\r\n    rclpy.spin(node)                # Keep the node alive and processing events\r\n    node.destroy_node()             # Clean up when the node is stopped\r\n    rclpy.shutdown()                # Shut down ROS 2 communication\r\n\r\nif __name__ == '__main__':\r\n    main()\n"})}),"\n",(0,s.jsxs)(n.p,{children:["To make this executable, add an entry point in ",(0,s.jsx)(n.code,{children:"setup.py"})," (inside the ",(0,s.jsx)(n.code,{children:"entry_points"})," dictionary):"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"    entry_points={\r\n        'console_scripts': [\r\n            'minimal_node = my_python_pkg.minimal_node:main',\r\n        ],\r\n    },\n"})}),"\n",(0,s.jsx)(n.p,{children:"Then, build and run:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"cd ~/ros2_ws\r\ncolcon build --packages-select my_python_pkg\r\nsource install/setup.bash\r\nros2 run my_python_pkg minimal_node\n"})}),"\n",(0,s.jsx)(n.h3,{id:"2-creating-a-publisher",children:"2. Creating a Publisher"}),"\n",(0,s.jsx)(n.p,{children:"To publish messages, a node needs to create a publisher:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"import rclpy\r\nfrom rclpy.node import Node\r\nfrom std_msgs.msg import String # Import the message type\r\n\r\nclass SimplePublisher(Node):\r\n    def __init__(self):\r\n        super().__init__('simple_publisher')\r\n        self.publisher_ = self.create_publisher(String, 'chatter', 10) # type, topic name, queue size\r\n        self.timer = self.create_timer(0.5, self.timer_callback) # timer for publishing\r\n        self.i = 0\r\n\r\n    def timer_callback(self):\r\n        msg = String()\r\n        msg.data = f'Hello ROS 2 from Python: {self.i}'\r\n        self.publisher_.publish(msg)\r\n        self.get_logger().info(f'Publishing: \"{msg.data}\"')\r\n        self.i += 1\r\n\r\ndef main(args=None):\r\n    rclpy.init(args=args)\r\n    node = SimplePublisher()\r\n    rclpy.spin(node)\r\n    node.destroy_node()\r\n    rclpy.shutdown()\r\n\r\nif __name__ == '__main__':\r\n    main()\n"})}),"\n",(0,s.jsx)(n.h3,{id:"3-creating-a-subscriber",children:"3. Creating a Subscriber"}),"\n",(0,s.jsx)(n.p,{children:"To subscribe to messages, a node needs to create a subscriber:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"import rclpy\r\nfrom rclpy.node import Node\r\nfrom std_msgs.msg import String\r\n\r\nclass SimpleSubscriber(Node):\r\n    def __init__(self):\r\n        super().__init__('simple_subscriber')\r\n        self.subscription = self.create_subscription(\r\n            String,             # Message type\r\n            'chatter',          # Topic name\r\n            self.listener_callback, # Callback function\r\n            10                  # Queue size\r\n        )\r\n        self.get_logger().info(\"Simple Subscriber is listening...\")\r\n\r\n    def listener_callback(self, msg):\r\n        self.get_logger().info(f'I heard: \"{msg.data}\"')\r\n\r\ndef main(args=None):\r\n    rclpy.init(args=args)\r\n    node = SimpleSubscriber()\r\n    rclpy.spin(node)\r\n    node.destroy_node()\r\n    rclpy.shutdown()\r\n\r\nif __name__ == '__main__':\r\n    main()\n"})}),"\n",(0,s.jsx)(n.h3,{id:"4-implementing-a-service-server",children:"4. Implementing a Service Server"}),"\n",(0,s.jsx)(n.p,{children:"For request/reply communication, a node can act as a service server:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"import rclpy\r\nfrom rclpy.node import Node\r\nfrom example_interfaces.srv import AddTwoInts # A standard service type\r\n\r\nclass AddTwoIntsService(Node):\r\n    def __init__(self):\r\n        super().__init__('add_two_ints_server')\r\n        self.srv = self.create_service(AddTwoInts, 'add_two_ints', self.add_two_ints_callback)\r\n        self.get_logger().info(\"AddTwoInts Service Server ready.\")\r\n\r\n    def add_two_ints_callback(self, request, response):\r\n        response.sum = request.a + request.b\r\n        self.get_logger().info(f'Incoming request: a={request.a}, b={request.b}, sum={response.sum}')\r\n        return response\r\n\r\ndef main(args=None):\r\n    rclpy.init(args=args)\r\n    node = AddTwoIntsService()\r\n    rclpy.spin(node)\r\n    node.destroy_node()\r\n    rclpy.shutdown()\r\n\r\nif __name__ == '__main__':\r\n    main()\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsxs)(n.em,{children:["Note: You might need to install ",(0,s.jsx)(n.code,{children:"example_interfaces"})," if not already present: ",(0,s.jsx)(n.code,{children:"sudo apt install ros-<ROS_DISTRO>-example-interfaces"})]})}),"\n",(0,s.jsx)(n.h3,{id:"5-implementing-a-service-client",children:"5. Implementing a Service Client"}),"\n",(0,s.jsx)(n.p,{children:"A node can call a service provided by another node:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"import rclpy\r\nfrom rclpy.node import Node\r\nfrom example_interfaces.srv import AddTwoInts\r\nimport sys\r\n\r\nclass AddTwoIntsClient(Node):\r\n    def __init__(self):\r\n        super().__init__('add_two_ints_client')\r\n        self.cli = self.create_client(AddTwoInts, 'add_two_ints')\r\n        while not self.cli.wait_for_service(timeout_sec=1.0):\r\n            self.get_logger().info('service not available, waiting again...')\r\n        self.req = AddTwoInts.Request()\r\n\r\n    def send_request(self, a, b):\r\n        self.req.a = a\r\n        self.req.b = b\r\n        self.future = self.cli.call_async(self.req)\r\n        self.get_logger().info(f'Sending request: a={a}, b={b}')\r\n\r\ndef main(args=None):\r\n    rclpy.init(args=args)\r\n    if len(sys.argv) != 3:\r\n        print('Usage: ros2 run my_python_pkg add_two_ints_client <int> <int>')\r\n        return\r\n    \r\n    client = AddTwoIntsClient()\r\n    client.send_request(int(sys.argv[1]), int(sys.argv[2]))\r\n\r\n    while rclpy.ok():\r\n        rclpy.spin_once(client)\r\n        if client.future.done():\r\n            try:\r\n                response = client.future.result()\r\n            except Exception as e:\r\n                client.get_logger().error(f'Service call failed: {e}')\r\n            else:\r\n                client.get_logger().info(\r\n                    f'Result of add_two_ints: for {client.req.a} + {client.req.b} = {response.sum}'\r\n                )\r\n            break\r\n    \r\n    client.destroy_node()\r\n    rclpy.shutdown()\r\n\r\nif __name__ == '__main__':\r\n    main()\n"})}),"\n",(0,s.jsx)(n.h2,{id:"best-practices-for-structuring-python-ros-2-applications",children:"Best Practices for Structuring Python ROS 2 Applications"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Modular Design"}),": Break down your application into small, single-responsibility nodes."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Clear Entry Points"}),": Use ",(0,s.jsx)(n.code,{children:"main()"})," functions and ",(0,s.jsx)(n.code,{children:"entry_points"})," in ",(0,s.jsx)(n.code,{children:"setup.py"})," for clear execution."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Message and Service Types"}),": Always use the correct message and service types, and if necessary, define your own custom types for complex data structures."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Logging"}),": Use ",(0,s.jsx)(n.code,{children:"self.get_logger().info()"}),", ",(0,s.jsx)(n.code,{children:"warn()"}),", ",(0,s.jsx)(n.code,{children:"error()"})," for informative output, not ",(0,s.jsx)(n.code,{children:"print()"}),"."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Error Handling"}),": Implement robust error handling, especially for service calls and external dependencies."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Configuration"}),": Utilize ROS 2 parameters to make your nodes configurable without code changes."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Package Structure"}),": Keep your Python scripts organized within your package directory."]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"By following these guidelines and leveraging the power of RCLPY, you can develop efficient, readable, and maintainable ROS 2 applications in Python."})]})}function p(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}},8453:(e,n,r)=>{r.d(n,{R:()=>o,x:()=>a});var i=r(6540);const s={},t=i.createContext(s);function o(e){const n=i.useContext(t);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:o(e.components),i.createElement(t.Provider,{value:n},e.children)}}}]);